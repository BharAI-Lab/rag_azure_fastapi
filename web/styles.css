/* ChatGPT-inspired palette (dark default) */
:root{
  --bg:#343541; --panel:#444654; --user:#343541; --text:#ECECF1; --muted:#ACACBE;
  --input:#40414F; --border:#565869; --accent:#10A37F; --accent-2:#19BC99;
}
html[data-theme="light"]{
  --bg:#FFFFFF; --panel:#F7F7F8; --user:#FFFFFF; --text:#202123; --muted:#66686C;
  --input:#FFFFFF; --border:#E5E5EA; --accent:#10A37F; --accent-2:#19BC99;
}

*{ box-sizing:border-box }
html, body { height: 100% }
body{
  margin:0; background: var(--bg); color: var(--text);
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
}

/* Top bar */
.topbar{
  max-width: 980px; margin: 0 auto; padding: 12px 16px;
  display:flex; align-items:center; justify-content:space-between;
}
.brand{ display:flex; align-items:center; gap:12px }
.logo{
  width:36px; height:36px; border-radius:8px; display:grid; place-items:center;
  background: var(--panel); border: 1px solid var(--border);
}
.titles h1{ margin:0; font-size:18px; font-weight:700 }
.titles p{ margin:0; color:var(--muted); font-size:12px }
.controls{ display:flex; align-items:center; gap:8px }

.btn{
  padding: 10px 12px; border-radius: 8px; border: 1px solid var(--border);
  background: var(--panel); color: var(--text); cursor: pointer;
}
.btn.primary{
  background: linear-gradient(180deg, var(--accent-2), var(--accent));
  border-color: transparent; color: white; font-weight: 700;
}
.btn.ghost{ background: transparent }
.btn.link{ background: transparent; border: 1px solid var(--border); color: var(--muted) }
.btn:disabled{ opacity:.6; cursor:not-allowed }

/* Main chat container */
.container{ max-width: 980px; margin: 0 auto; padding: 0 16px 96px }
.chat-window{ min-height: calc(100vh - 180px); padding: 12px 0; overflow-y:auto; scroll-behavior:smooth }

/* Messages */
.message{ display:flex; gap:12px; padding: 12px 0 }
.avatar{
  flex:0 0 32px; width:32px; height:32px; background: var(--panel);
  border: 1px solid var(--border); border-radius: 6px; display:grid; place-items:center; font-size: 16px;
}
.bubble{
  max-width: 800px; width: fit-content; background: var(--panel); border: 1px solid var(--border);
  border-radius: 10px; padding: 12px 14px; line-height: 1.55; position: relative;
}
.user .bubble{ background: var(--user) }
.system .bubble{ opacity:.9 }
.bubble h2,.bubble h3{ margin:6px 0 8px; font-size:16px }
.bubble p{ margin:8px 0 }
.bubble ul{ margin:6px 0 8px 18px }
.bubble li{ margin:2px 0 }
.bubble code{
  background: rgba(255,255,255,.06); border: 1px solid var(--border);
  padding: 2px 6px; border-radius: 6px;
}
.bubble pre{
  background: rgba(255,255,255,.06); border: 1px solid var(--border);
  padding: 10px; border-radius: 8px; overflow:auto;
}
.time{ margin-top:6px; font-size:12px; color: var(--muted) }

/* Copy button */
.copy-btn{
  position:absolute; top:8px; right:8px; font-size:12px; padding:6px 8px;
  border-radius:6px; border:1px solid var(--border); background: transparent; color: var(--muted);
}
.copy-btn:hover{ background: rgba(255,255,255,.05) }

/* Sources inline accordion */
.sources{ margin-top:10px; border-top: 1px solid var(--border); padding-top:8px }
.sources summary{ cursor:pointer; color: var(--muted); list-style:none }
.sources summary::-webkit-details-marker{ display:none }
.source-list{ padding-left:0; margin:8px 0 0 }
.source-item{
  list-style:none; border:1px solid var(--border); border-radius:8px; padding:8px; margin-bottom:8px;
  background: rgba(255,255,255,.04);
}
.source-title{ font-size:13px; color: var(--text) }
.source-snippet{ font-size:12px; color: var(--muted); margin-top:4px }

/* Optional chart holder (we now only use 3D in panel) */
.chart{ margin-top:8px; border:1px solid var(--border); border-radius:8px; overflow:hidden }

/* Loading skeleton */
.loading{
  background: linear-gradient(90deg, rgba(255,255,255,.05), rgba(255,255,255,.12), rgba(255,255,255,.05));
  background-size: 200% 100%; animation: shimmer 1.2s infinite linear;
}
@keyframes shimmer{ 0%{background-position: 200% 0} 100%{background-position:-200% 0} }

/* Composer (sticky bottom) */
.composer{
  position: fixed; left:0; right:0; bottom:12px; margin:0 auto; max-width:980px; padding:8px;
  display:flex; gap:10px; align-items:flex-end; background: var(--bg);
}
.ask{
  flex:1; min-height:44px; max-height:200px; resize:vertical; padding:12px 14px; border-radius:10px;
  border:1px solid var(--border); background: var(--input); color: var(--text);
}
.ask::placeholder{ color: var(--muted) }
.actions{ display:flex; gap:10px }

/* jump to latest */
.jump{ position: fixed; left: 50%; transform: translateX(-50%); bottom: 74px; display:none }
.btn.ghost{ background: var(--input); color: var(--text) }

/* Footer */
.footnote{ text-align:center; color: var(--muted); font-size:12px; padding: 8px 0 16px }

/* A11y */
.sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); border:0 }

/* Slide-in panel */
.panel{
  position: fixed; top:0; right:0; height:100vh; width:min(520px, 92vw);
  transform: translateX(100%); transition: transform .25s ease;
  background: var(--panel); border-left:1px solid var(--border); color: var(--text); z-index: 50;
  display:flex; flex-direction:column;
}
.panel[aria-hidden="false"]{ transform: translateX(0) }
.panel-header{ display:flex; align-items:center; justify-content:space-between; padding:12px 14px; border-bottom:1px solid var(--border) }
.panel-content{ padding: 12px 14px; overflow: auto }
.backdrop{
  position: fixed; inset:0; background: rgba(0,0,0,.35); z-index: 40;
}

/* Responsive */
@media (max-width: 640px){
  .topbar { padding: 10px 12px }
  .container { padding: 0 12px 96px }
}
